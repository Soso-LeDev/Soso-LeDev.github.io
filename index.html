<!DOCTYPE html>
<html lang="fr">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>Chat avec Scout</title>
Â  <style>
Â  Â  * { box-sizing: border-box; }
Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  font-family: 'Segoe UI', sans-serif;
Â  Â  Â  background-color: #ece5dd;
Â  Â  Â  display: flex; flex-direction: column; height: 100vh;
Â  Â  }
Â  Â  header {
Â  Â  Â  background-color: #075e54; color: white;
Â  Â  Â  padding: 16px; font-size: 18px; font-weight: bold;
Â  Â  Â  text-align: center; position: relative;
Â  Â  }
Â  Â  #clearBtn {
Â  Â  Â  position: absolute; right: 16px; top: 50%;
Â  Â  Â  transform: translateY(-50%);
Â  Â  Â  background: none; border: none;
Â  Â  Â  color: white; font-size: 20px; cursor: pointer;
Â  Â  }
Â  Â  #chat {
Â  Â  Â  flex: 1; padding: 10px;
Â  Â  Â  overflow-y: auto; display: flex;
Â  Â  Â  flex-direction: column; gap: 8px;
Â  Â  Â  background-image: url('https://i.imgur.com/3eF1QTT.png');
Â  Â  Â  background-size: cover;
Â  Â  }
Â  Â  .message {
Â  Â  Â  max-width: 80%; padding: 10px 14px;
Â  Â  Â  border-radius: 8px; font-size: 15px;
Â  Â  Â  line-height: 1.4; white-space: pre-wrap;
Â  Â  Â  word-wrap: break-word;
Â  Â  }
Â  Â  .user {
Â  Â  Â  align-self: flex-end;
Â  Â  Â  background-color: #dcf8c6;
Â  Â  Â  border-bottom-right-radius: 0;
Â  Â  }
Â  Â  .bot {
Â  Â  Â  align-self: flex-start;
Â  Â  Â  background-color: #ffffff;
Â  Â  Â  border-bottom-left-radius: 0;
Â  Â  }
Â  Â  #inputArea {
Â  Â  Â  display: flex; padding: 10px;
Â  Â  Â  border-top: 1px solid #ccc; background-color: #f0f0f0;
Â  Â  }
Â  Â  input {
Â  Â  Â  flex: 1; padding: 12px;
Â  Â  Â  font-size: 16px; border-radius: 20px;
Â  Â  Â  border: none; outline: none; background-color: white;
Â  Â  }
Â  Â  button {
Â  Â  Â  margin-left: 8px; padding: 12px 16px;
Â  Â  Â  background-color: #25d366; color: white;
Â  Â  Â  font-size: 16px; border: none;
Â  Â  Â  border-radius: 50%; cursor: pointer;
Â  Â  }
Â  Â  button:hover { background-color: #128c7e; }
Â  Â  @media (max-width: 600px) {
Â  Â  Â  header { font-size: 16px; }
Â  Â  Â  .message { font-size: 14px; }
Â  Â  Â  input { font-size: 15px; }
Â  Â  }
Â  </style>
</head>
<body>

Â  <header>
Â  Â  Scout â€“ Assistant IA
Â  Â  <button id="clearBtn" onclick="resetConversation()" title="Effacer la conversation">ğŸ—‘ï¸</button>
Â  </header>

Â  <div id="chat"></div>

Â  <div id="inputArea">
Â  Â  <input type="text" id="userInput" placeholder="Ã‰crivez un message..." />
Â  Â  <button onclick="sendMessage()" aria-label="Envoyer le message">â–¶ï¸</button>
Â  </div>

Â  <script>
Â  Â  // === CONSTANTES API ===
Â  Â  const cx = "24246487405284f60";
Â  Â  const googleApiKey = "AIzaSyCPD1222E1X5kX7N6PHFwLuyIeisrbIAKM";
Â  Â  const groqApiKey = "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";
Â  Â  const model = "meta-llama/llama-4-scout-17b-16e-instruct";
Â  Â  const groqUrl = "https://api.groq.com/openai/v1/chat/completions";

Â  Â  const SYSTEM_PROMPT = {
Â  Â  Â  role: "system",
Â  Â  Â  content: `Vous Ãªtes Scout, un assistant IA humain, respectueux et chaleureux. Vous parlez Ã  Soan. Vous devez toujours le vouvoyer avec bienveillance. RÃ©pondez clairement, poliment, et avec empathie.`
Â  Â  };

Â  Â  const chatBox = document.getElementById("chat");
Â  Â  const inputField = document.getElementById("userInput");

Â  Â  // RÃ©cupÃ¨re l'historique
Â  Â  let messages = JSON.parse(localStorage.getItem("chatHistory")) || [SYSTEM_PROMPT];
Â  Â  window.onload = () => {
Â  Â  Â  messages.forEach(msg => {
Â  Â  Â  Â  if (msg.role === "user") displayMessage("Soan", msg.content, "user");
Â  Â  Â  Â  if (msg.role === "assistant") displayMessage("Scout", msg.content, "bot");
Â  Â  Â  });
Â  Â  };
Â  Â  function saveMessages() {
Â  Â  Â  localStorage.setItem("chatHistory", JSON.stringify(messages));
Â  Â  }
Â  Â  function displayMessage(sender, text, type) {
Â  Â  Â  const msgDiv = document.createElement("div");
Â  Â  Â  msgDiv.className = `message ${type}`;
Â  Â  Â  msgDiv.textContent = text;
Â  Â  Â  chatBox.appendChild(msgDiv);
Â  Â  Â  chatBox.scrollTop = chatBox.scrollHeight;
Â  Â  }
Â  Â  function resetConversation() {
Â  Â  Â  if (confirm("Souhaitez-vous vraiment effacer cette conversationâ€¯?")) {
Â  Â  Â  Â  localStorage.removeItem("chatHistory");
Â  Â  Â  Â  location.reload();
Â  Â  Â  }
Â  Â  }

Â  Â  // === FONCTION QUI DÃ‰CIDE SI ON DOIT RECHERCHER ===
Â  Â  function needsSearch(query) {
Â  Â  Â  const interrogatifs = /\b(google|internet)\b/i;
Â  Â  Â  return interrogatifs.test(query);
Â  Â  }

Â  Â  // === APPEL Ã€ L'API GOOGLE CUSTOM SEARCH ===
Â  Â  async function searchGoogle(query) {
Â  Â  Â  const url = `https://www.googleapis.com/customsearch/v1?key=${googleApiKey}&cx=${cx}&q=${encodeURIComponent(query)}`;
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(url);
Â  Â  Â  Â  if (!res.ok) throw new Error(res.statusText);
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  // on prend les 3 premiers rÃ©sultats
Â  Â  Â  Â  return data.items?.slice(0, 3).map(item =>
Â  Â  Â  Â  Â  `â€¢ ${item.title}\n  ${item.snippet}`
Â  Â  Â  Â  ).join("\n") || "Aucun rÃ©sultat trouvÃ©.";
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  return `Erreur Google Search : ${err.message}`;
Â  Â  Â  }
Â  Â  }

Â  Â  // === ENVOI DE MESSAGE ===
Â  Â  async function sendMessage() {
Â  Â  Â  const userMessage = inputField.value.trim();
Â  Â  Â  if (!userMessage) return;

Â  Â  Â  // affiche la question utilisateur
Â  Â  Â  messages.push({ role: "user", content: userMessage });
Â  Â  Â  displayMessage("Soan", userMessage, "user");
Â  Â  Â  inputField.value = "";
Â  Â  Â  saveMessages();

Â  Â  Â  let enrichedMessages = [...messages];

Â  Â  Â  // si besoin de recherche, on interroge Google et on ajoute un systÃ¨me
Â  Â  Â  if (needsSearch(userMessage)) {
Â  Â  Â  Â  displayMessage("Scout", "Recherche d'informations...", "bot");
Â  Â  Â  Â  const results = await searchGoogle(userMessage);
Â  Â  Â  Â  enrichedMessages.push({
Â  Â  Â  Â  Â  role: "system",
Â  Â  Â  Â  Â  content: `RÃ©sultats de recherche Googleâ€¯:\n${results}`
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  // appel Ã  Groq
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(groqUrl, {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  "Content-Type": "application/json",
Â  Â  Â  Â  Â  Â  "Authorization": `Bearer ${groqApiKey}`
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  model,
Â  Â  Â  Â  Â  Â  messages: enrichedMessages
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  });
Â  Â  Â  Â  const json = await res.json();
Â  Â  Â  Â  const reply = json.choices?.[0]?.message?.content || "[RÃ©ponse vide]";
Â  Â  Â  Â  messages.push({ role: "assistant", content: reply });
Â  Â  Â  Â  displayMessage("Scout", reply, "bot");
Â  Â  Â  Â  saveMessages();
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  displayMessage("Scout", `âŒ Erreur : ${err.message}`, "bot");
Â  Â  Â  }
Â  Â  }

Â  Â  inputField.addEventListener("keypress", e => {
Â  Â  Â  if (e.key === "Enter") sendMessage();
Â  Â  });
Â  </script>
</body>
</html>
