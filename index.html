<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Reconnaissance Faciale Plein Écran</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    video, canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      transform: scaleX(-1); /* effet miroir */
    }
    #status {
      position: fixed;
      bottom: 10px;
      left: 10px;
      color: #00ff99;
      font-family: monospace;
      background: rgba(0,0,0,0.5);
      padding: 6px 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <video id="video" autoplay muted playsinline></video>
  <canvas id="canvas"></canvas>
  <div id="status">Initialisation...</div>

  <!-- MediaPipe Face Detection -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const statusText = document.getElementById('status');
    let camera = null;
    let running = false;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    const faceDetection = new FaceDetection({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${file}`
    });

    faceDetection.setOptions({
      model: 'short',           // modèle rapide (mobile)
      minDetectionConfidence: 0.5
    });

    faceDetection.onResults(onResults);

    async function onResults(results) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (!results.detections || results.detections.length === 0) return;

      const width = canvas.width;
      const height = canvas.height;

      for (const detection of results.detections) {
        const box = detection.boundingBox;
        const x = (1 - box.xCenter - box.width / 2) * width;
        const y = box.yCenter * height - (box.height * height) / 2;
        const w = box.width * width;
        const h = box.height * height;

        // --- Rectangle principal ---
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#00ff99';
        ctx.shadowColor = '#00ffaa';
        ctx.shadowBlur = 15;
        ctx.strokeRect(x, y, w, h);

        // --- Traits décoratifs (coins) ---
        const len = Math.min(w, h) * 0.25;
        ctx.shadowBlur = 0;
        ctx.lineWidth = 4;
        ctx.strokeStyle = '#00ffcc';
        ctx.beginPath();
        // coin haut gauche
        ctx.moveTo(x, y + len);
        ctx.lineTo(x, y);
        ctx.lineTo(x + len, y);
        // coin haut droit
        ctx.moveTo(x + w - len, y);
        ctx.lineTo(x + w, y);
        ctx.lineTo(x + w, y + len);
        // coin bas gauche
        ctx.moveTo(x, y + h - len);
        ctx.lineTo(x, y + h);
        ctx.lineTo(x + len, y + h);
        // coin bas droit
        ctx.moveTo(x + w - len, y + h);
        ctx.lineTo(x + w, y + h);
        ctx.lineTo(x + w, y + h - len);
        ctx.stroke();

        // --- Point central ---
        const cx = x + w / 2;
        const cy = y + h / 2;
        ctx.beginPath();
        ctx.arc(cx, cy, 4, 0, Math.PI * 2);
        ctx.fillStyle = '#00ff99';
        ctx.fill();
      }
    }

    async function start() {
      if (running) return;
      running = true;
      statusText.textContent = 'Activation caméra...';

      camera = new Camera(video, {
        onFrame: async () => {
          await faceDetection.send({image: video});
        },
        width: 1280,
        height: 720
      });

      try {
        await camera.start();
        statusText.textContent = 'Caméra active — détection en cours';
      } catch (e) {
        console.error(e);
        statusText.textContent = 'Erreur caméra : ' + e.message;
        alert('Active ta caméra (HTTPS ou localhost requis).');
      }
    }

    start();
  </script>
</body>
</html>
