<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reconnaissance Faciale avec Champ Nom</title>
<style>
  html, body { margin:0; padding:0; height:100%; overflow:hidden; background:#000; color:#fff; font-family:Arial, sans-serif; }
  video, canvas { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; }
  #ui { position:fixed; top:10px; left:10px; background:rgba(0,0,0,0.5); padding:10px; border-radius:8px; }
  input[type="text"]{padding:5px; border-radius:5px; border:none;}
</style>
</head>
<body>
<div id="ui">
  Nom / note: <input id="noteInput" type="text" placeholder="Ex: Max ou Ami...">
</div>

<video id="video" autoplay muted playsinline></video>
<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.min.js"></script>
<script>
(async()=>{
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const noteInput = document.getElementById('noteInput');

  // charger modèles
  await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
  await faceapi.nets.ageGenderNet.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');

  // démarrer la caméra
  const stream = await navigator.mediaDevices.getUserMedia({ video: { width:1280, height:720 } });
  video.srcObject = stream;
  await video.play();

  function resizeCanvas(){
    canvas.width = video.videoWidth || window.innerWidth;
    canvas.height = video.videoHeight || window.innerHeight;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  async function loop(){
    resizeCanvas();
    ctx.clearRect(0,0,canvas.width,canvas.height);

    const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withAgeAndGender();

    detections.forEach(det=>{
      const box = det.detection.box;
      ctx.lineWidth=3;
      ctx.strokeStyle='#00ff99';
      ctx.strokeRect(box.x, box.y, box.width, box.height);

      // texte avec âge/genre + note
      const age = det.age ? Math.round(det.age*10)/10 : '?';
      const gender = det.gender ? (det.gender==='male'?'Homme':'Femme') : '?';
      const note = noteInput.value || '';
      const text = `${gender}, ~${age} ans ${note ? '- ' + note : ''}`;
      ctx.fillStyle='rgba(0,0,0,0.6)';
      ctx.fillRect(box.x, box.y - 25, ctx.measureText(text).width + 10, 20);
      ctx.fillStyle='white';
      ctx.font='16px Arial';
      ctx.fillText(text, box.x + 5, box.y - 8);
    });

    requestAnimationFrame(loop);
  }
  loop();
})();
</script>
</body>
</html>
