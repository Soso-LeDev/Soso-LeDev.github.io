<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>SCP‚ÄëRedux ‚Ä¢ Portail</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { background: #060606; color: #E2E8F0; }
    .neon { text-shadow: 0 0 8px #10B981; }
    .card { backdrop-filter: blur(10px); background: rgba(20,20,20,0.6); }
  </style>
</head>
<body class="font-sans antialiased flex flex-col items-center p-6 space-y-6">

  <h1 class="neon text-4xl font-bold">üõ°Ô∏è SCP‚ÄëRedux Portal</h1>

  <!-- Connexion Google -->
  <div id="google-login" class="card p-6 rounded-lg shadow-lg space-y-4">
    <p class="text-center">Connecte-toi pour acc√©der au chat & √† l‚Äô√©quipe</p>
    <div id="g_id_onload"
         data-client_id="623343442822-vg5208651s2f9jfdlr6d65379lehna8b.apps.googleusercontent.com"
         data-callback="onGoogleLogin"
         data-auto_prompt="false"></div>
    <div class="g_id_signin" data-type="standard" data-size="large"
         data-theme="outline" data-text="sign_in_with"
         data-shape="pill" data-logo_alignment="left"></div>
  </div>

  <!-- Conteneur principal, cach√© si non connect√© -->
  <div id="mainContent" class="hidden flex-col space-y-8 items-center w-full max-w-3xl">

    <!-- Profil & D√©connexion -->
    <div id="userInfo" class="flex items-center justify-between w-full card p-4 rounded-lg">
      <div class="flex items-center space-x-4">
        <img id="userPic" src="" alt="avatar" class="w-12 h-12 rounded-full border border-[#10B981]" />
        <div>
          <p id="userName" class="font-semibold"></p>
          <p id="userEmail" class="text-sm text-gray-400"></p>
        </div>
      </div>
      <button onclick="logout()" class="px-4 py-2 bg-red-600 rounded-md hover:bg-red-500">D√©connexion</button>
    </div>

    <!-- Chat ‚Äúkrozen‚Äù -->
    <div class="w-full card rounded-lg shadow-lg p-4 space-y-4">
      <h2 class="text-2xl neon">Chat ‚Äúkrozen‚Äù</h2>
      <div id="chatBox" class="h-64 overflow-y-auto p-3 bg-gray-900 rounded-md space-y-2"></div>
      <div class="flex space-x-2">
        <input id="chatInput" type="text" placeholder="Parle √† krozen..." class="flex-1 p-2 rounded-md bg-gray-800 focus:outline-green-500"/>
        <button onclick="sendChat()" class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-md">‚û§</button>
      </div>
    </div>

    <!-- Formulaire recrutement -->
    <div class="w-full card rounded-lg p-4 space-y-4 shadow-lg">
      <h2 class="text-2xl neon">Postuler au projet</h2>
      <form id="recruitForm" class="space-y-4">
        <input type="text" id="fullName" placeholder="Nom complet" class="w-full p-2 rounded-md bg-gray-800" required/>
        <input type="email" id="emailApply" placeholder="Email" class="w-full p-2 rounded-md bg-gray-800" required/>
        <select id="roleSelect" class="w-full p-2 rounded-md bg-gray-800">
          <option value="dev">D√©veloppeur</option>
          <option value="designer">Designer</option>
          <option value="tester">Testeur</option>
          <option value="autre">Autre</option>
        </select>
        <textarea id="motivation" rows="4" placeholder="Pourquoi tu veux rejoindre ?" class="w-full p-2 rounded-md bg-gray-800" required></textarea>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-500 py-2 rounded-md">Envoyer la demande</button>
      </form>
      <div id="applyMsg" class="text-center text-green-300 hidden">‚úÖ Merci, ta candidature a √©t√© envoy√©e‚ÄØ!</div>
    </div>
  </div>

  <script>
    let googleUser = null;

    function onGoogleLogin(response) {
      const p = JSON.parse(atob(response.credential.split('.')[1]));
      googleUser = p;
      document.getElementById('userName').textContent = p.name;
      document.getElementById('userEmail').textContent = p.email;
      document.getElementById('userPic').src = p.picture;
      document.getElementById('google-login').classList.add('hidden');
      document.getElementById('mainContent').classList.remove('hidden');
      appendChat('[SYSTEM] Bienvenue ' + p.name);
    }

    function logout() {
      googleUser = null;
      document.getElementById('mainContent').classList.add('hidden');
      document.getElementById('google-login').classList.remove('hidden');
      document.getElementById('chatBox').innerHTML = '';
    }

    /* Chat */
    function appendChat(msg, from='user') {
      const d = document.createElement('div');
      d.textContent = msg;
      d.className = 'p-2 rounded ' + (from==='user'? 'bg-blue-800 self-end':'bg-gray-700 self-start');
      document.getElementById('chatBox').appendChild(d);
      d.scrollIntoView({behavior:'smooth'});
    }

    async function sendChat() {
      const txt = document.getElementById('chatInput').value.trim();
      if (!txt) return;
      appendChat(txt, 'user');
      document.getElementById('chatInput').value = '';
      // Appel API √† "krozen" (remplace avec ton vrai endpoint + auth)
      const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method:'POST',
        headers: {
          'Content-Type':'application/json',
          'Authorization':'Bearer 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'
        },
        body: JSON.stringify({
          model: "llama3-8b-8192",
          messages: [
            {role:'system', content: 'Tu es krozen, assistant expert SCP & recrutement.'},
            {role:'user', content: txt}
          ],
          temperature: 0.6
        })
      });
      const j = await res.json().catch(()=>null);
      const reply = j?.choices?.[0]?.message?.content || '[Erreur de krozen]';
      appendChat(reply, 'assistant');
    }

    /* Recrutement */
    document.getElementById('recruitForm').addEventListener('submit', e=>{
      e.preventDefault();
      // ‚Üí envoi vers back ou API ici (placeholder)
      console.log({
        name:document.getElementById('fullName').value,
        email:document.getElementById('emailApply').value,
        role:document.getElementById('roleSelect').value,
        message:document.getElementById('motivation').value
      });
      document.getElementById('applyMsg').classList.remove('hidden');
      setTimeout(()=>document.getElementById('applyMsg').classList.add('hidden'), 5000);
      e.target.reset();
    });
  </script>
</body>
</html>
